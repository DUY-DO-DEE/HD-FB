<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin System | DUYDODEE-HD</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öôÔ∏è</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
    :root {
        --primary: #ff4e00;
        --bg-dark: #050505;
        --bg-card: #141414;
        --text-light: #e0e0e0;
    }
    body { margin: 0; font-family: 'Prompt', sans-serif; background: var(--bg-dark); color: var(--text-light); }
    
    /* --- Layout --- */
    .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
    
    /* --- Login Modal --- */
    #login-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.95); z-index: 1000;
        display: flex; align-items: center; justify-content: center;
        backdrop-filter: blur(10px);
    }
    .login-box {
        background: #1a1a1a; padding: 40px; border-radius: 20px;
        width: 100%; max-width: 400px; text-align: center;
        border: 1px solid rgba(255, 78, 0, 0.3);
        box-shadow: 0 0 30px rgba(255, 78, 0, 0.2);
    }
    .login-logo { font-size: 40px; margin-bottom: 20px; display: block; }
    
    /* --- Dashboard --- */
    #dashboard-screen { display: none; } /* Hidden by default */
    
    .header { 
        display: flex; justify-content: space-between; align-items: center; 
        padding: 20px 0; border-bottom: 1px solid #333; margin-bottom: 30px;
    }
    .brand { font-size: 24px; font-weight: 600; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    
    /* --- Forms --- */
    .form-card { 
        background: var(--bg-card); padding: 30px; border-radius: 16px; 
        border: 1px solid #333; margin-bottom: 40px;
    }
    .form-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    
    .input-group { margin-bottom: 18px; }
    .input-group label { display: block; margin-bottom: 8px; color: #aaa; font-size: 14px; }
    .input-group input, .input-group select, .input-group textarea {
        width: 100%; padding: 12px; background: #0a0a0a; border: 1px solid #333;
        color: #fff; border-radius: 8px; font-family: 'Prompt'; font-size: 15px;
        transition: 0.3s;
    }
    .input-group input:focus { border-color: var(--primary); outline: none; }
    
    .note { font-size: 12px; color: #f39c12; margin-top: 5px; display: none; }
    
    /* --- Buttons --- */
    .btn { 
        padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; 
        font-family: 'Prompt'; font-weight: 500; transition: 0.3s; 
    }
    .btn-primary { background: var(--primary); color: #fff; width: 100%; font-size: 16px; padding: 12px; }
    .btn-primary:hover { background: #ff6a00; transform: translateY(-2px); }
    .btn-danger { background: #d32f2f; color: #fff; }
    .btn-secondary { background: #333; color: #ccc; }
    .btn-edit { background: #007bff; color: #fff; margin-right: 5px; }
    
    /* --- List --- */
    .movie-item {
        display: flex; gap: 20px; background: var(--bg-card);
        padding: 15px; border-radius: 12px; margin-bottom: 15px;
        border: 1px solid #222; align-items: center;
    }
    .movie-thumb { width: 70px; height: 100px; object-fit: cover; border-radius: 8px; background: #333; }
    .movie-info { flex-grow: 1; }
    .movie-info h3 { margin: 0 0 5px 0; color: #fff; font-size: 18px; }
    .badge { 
        font-size: 12px; padding: 3px 8px; border-radius: 4px; 
        background: #333; color: #aaa;
    }
    .actions { display: flex; gap: 10px; }

    @media (max-width: 600px) {
        .grid-2 { grid-template-columns: 1fr; }
        .movie-item { flex-direction: column; text-align: center; }
        .actions { width: 100%; justify-content: center; margin-top: 10px; }
    }
</style>
</head>
<body>

<!-- Login Overlay -->
<div id="login-screen">
    <div class="login-box">
        <span class="login-logo">üîí</span>
        <h2 style="margin-top:0;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h2>
        <form id="loginForm">
            <div class="input-group">
                <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Email)" required>
            </div>
            <div class="input-group">
                <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)" required>
            </div>
            <button type="submit" class="btn btn-primary">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </form>
    </div>
</div>

<!-- Main Dashboard -->
<div id="dashboard-screen" class="container">
    <div class="header">
        <div class="brand">üé¨ DUYDODEE Admin</div>
        <button id="logoutBtn" class="btn btn-danger">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div class="form-card">
        <div class="form-header">
            <h2 id="formTitle" style="margin:0;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
            <button id="cancelEditBtn" class="btn btn-secondary" style="display:none;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        </div>
        
        <form id="movieForm">
            <input type="hidden" id="editDocId"> <!-- ‡πÄ‡∏Å‡πá‡∏ö ID ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
            
            <div class="grid-2">
                <div class="input-group">
                    <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Category)</label>
                    <select id="category" required onchange="checkCategory()">
                        <option value="movie">üé¨ ‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option>
                        <option value="chinese_series_dubbed">üî• ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢</option>
                        <option value="chinese_series_vertical">üì± ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á (Short Drama)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á (Title)</label>
                    <input type="text" id="title" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏á‡∏Ñ‡πå‡∏£‡∏±‡∏Å‡∏©‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÅ‡∏û‡∏£..." required>
                </div>
            </div>

            <div class="grid-2">
                <div class="input-group">
                    <label>‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå (Poster URL) - ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á</label>
                    <input type="url" id="poster" placeholder="https://..." required>
                </div>
                <div class="input-group">
                    <label>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå (Banner URL) - ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô *‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</label>
                    <input type="url" id="banner" placeholder="‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö...">
                </div>
            </div>

            <div class="input-group">
                <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏±‡∏ö‡∏ä‡∏° (Video URL / Link)</label>
                <input type="text" id="link" placeholder="URL ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠ YouTube Link" required>
                <p id="verticalNote" class="note">‚ö†Ô∏è ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube (‡πÄ‡∏ä‡πà‡∏ô https://youtu.be/...) ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Embed ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
            </div>

            <div class="input-group">
                <label>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠ / ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (Description)</label>
                <textarea id="desc" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡∏±‡∏á..."></textarea>
            </div>

            <button type="submit" id="submitBtn" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </form>
    </div>

    <div class="movie-list">
        <h3 style="border-left: 4px solid var(--primary); padding-left: 10px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <div id="movieListContainer">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
    // Config ‡πÄ‡∏î‡∏¥‡∏° 100%
    const firebaseConfig = {
      apiKey: "AIzaSyAcCn0NGbakHmLEa_G47K8OepGaRqTV02Q",
      authDomain: "duydodeesport.firebaseapp.com",
      projectId: "duydodeesport",
      storageBucket: "duydodeesport.appspot.com",
      messagingSenderId: "435929814225",
      appId: "1:435929814225:web:fcb01803d9e5b77340e1f0",
      measurementId: "G-JD1MFCNLY0"
    };
    
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- UI Variables ---
    const loginScreen = document.getElementById('login-screen');
    const dashboardScreen = document.getElementById('dashboard-screen');
    const movieForm = document.getElementById('movieForm');
    const submitBtn = document.getElementById('submitBtn');
    const formTitle = document.getElementById('formTitle');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const editDocIdInput = document.getElementById('editDocId');

    // --- Auth Logic ---
    auth.onAuthStateChanged(user => {
        if (user) {
            loginScreen.style.display = 'none';
            dashboardScreen.style.display = 'block';
            loadMovies();
        } else {
            loginScreen.style.display = 'flex';
            dashboardScreen.style.display = 'none';
        }
    });

    document.getElementById('loginForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        auth.signInWithEmailAndPassword(email, password)
            .catch(error => alert("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message));
    });

    document.getElementById('logoutBtn').addEventListener('click', () => auth.signOut());

    // --- Helper UI ---
    window.checkCategory = function() {
        const cat = document.getElementById('category').value;
        const note = document.getElementById('verticalNote');
        note.style.display = (cat === 'chinese_series_vertical') ? 'block' : 'none';
    }

    // --- CRUD Logic ---
    movieForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        submitBtn.disabled = true;
        submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

        const docId = editDocIdInput.value; // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        const data = {
            category: document.getElementById('category').value,
            title: document.getElementById('title').value,
            poster: document.getElementById('poster').value,
            banner: document.getElementById('banner').value,
            desc: document.getElementById('desc').value,
            link: document.getElementById('link').value,
            createdAt: firebase.firestore.FieldValue.serverTimestamp() // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡πâ‡∏ß‡∏¢
        };

        try {
            if (docId) {
                // Update
                await db.collection('movies').doc(docId).update(data);
                alert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
                resetForm();
            } else {
                // Add New
                await db.collection('movies').add(data);
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
                movieForm.reset();
                checkCategory();
            }
        } catch (error) {
            console.error(error);
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = docId ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        }
    });

    // --- List & Actions ---
    function loadMovies() {
        const container = document.getElementById('movieListContainer');
        db.collection('movies').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
            container.innerHTML = '';
            if(snapshot.empty) {
                container.innerHTML = '<p style="text-align:center; color:#666;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                return;
            }

            snapshot.forEach(doc => {
                const item = doc.data();
                const div = document.createElement('div');
                div.className = 'movie-item';
                div.innerHTML = `
                    <img src="${item.poster || 'https://via.placeholder.com/100'}" class="movie-thumb" alt="Poster">
                    <div class="movie-info">
                        <div class="badge">${getCatName(item.category)}</div>
                        <h3>${item.title}</h3>
                        <div style="font-size:13px; color:#888;">${item.link ? 'üîó ‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß' : '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå'}</div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-edit" onclick="startEdit('''${doc.id}''')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn btn-danger" onclick="deleteMovie('''${doc.id}''', '''${item.title}''')">üóëÔ∏è ‡∏•‡∏ö</button>
                    </div>
                `;
                container.appendChild(div);
            });
        });
    }

    // --- Edit Mode ---
    window.startEdit = async function(id) {
        try {
            const doc = await db.collection('movies').doc(id).get();
            if(!doc.exists) return;
            const data = doc.data();

            // Populate Form
            editDocIdInput.value = id;
            document.getElementById('category').value = data.category;
            document.getElementById('title').value = data.title;
            document.getElementById('poster').value = data.poster;
            document.getElementById('banner').value = data.banner || '';
            document.getElementById('desc').value = data.desc || '';
            document.getElementById('link').value = data.link || '';
            
            checkCategory();

            // UI Change
            formTitle.textContent = '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + data.title;
            submitBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
            submitBtn.className = 'btn btn-edit'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°
            cancelEditBtn.style.display = 'block';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

        } catch (e) {
            console.error(e);
        }
    }

    cancelEditBtn.addEventListener('click', resetForm);

    function resetForm() {
        movieForm.reset();
        editDocIdInput.value = '';
        formTitle.textContent = '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà';
        submitBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        submitBtn.className = 'btn btn-primary';
        cancelEditBtn.style.display = 'none';
        checkCategory();
    }

    // --- Delete ---
    window.deleteMovie = function(id, title) {
        if(confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${title}" ?
‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ`)) {
            db.collection('movies').doc(id).delete().catch(err => alert(err.message));
        }
    }

    function getCatName(cat) {
        const names = {
            'movie': '‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå',
            'chinese_series_dubbed': '‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢',
            'chinese_series_vertical': '‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á'
        };
        return names[cat] || cat;
    }
</script>

</body>
</html>